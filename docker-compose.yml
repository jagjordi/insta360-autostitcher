# Insta360 autostitcher stack

version: '3.8'

services:
  backend:
    build:
      context: ./backend
      args:
        - MEDIA_SDK_DEB=${MEDIA_SDK_DEB:-libMediaSDK-dev_2.0-0_amd64_ubuntu18.04.deb}
    container_name: insta360-backend
    env_file:
      - .env
    environment:
      APP_STORAGE_DIR: /app
      RAW_DIR: /app/raw
      OUT_DIR: /app/stitched
    network_mode: host
    volumes:
      - ${APP_STORAGE_DIR}:/app

  frontend:
    build:
      context: ./frontend
      args:
        - VITE_API_BASE=${VITE_API_BASE:-}
    container_name: insta360-frontend
    network_mode: host
    environment:
      NGINX_PORT: ${FRONTEND_PORT:-3000}
      API_PROXY_TARGET: ${BACKEND_API_URL:-http://127.0.0.1:8000}
    environment:
      NGINX_PORT: ${FRONTEND_PORT:-3000}
